


blankChunk = {
  ground = {
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
     1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1

  },
  entitys = {
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  }
}








function genChunk2(x,y,id)
  print("setting up chunk to gen")
  tmpChunk = deepcopy(blankChunk)
  tmpChunk.id = id
  tmpChunk.x = x
  tmpChunk.y = y
  tmpChunk.lastTick = 0


  x = 0
  y = 0

  print("Genning Ground layer.")

  for i = 1, table.maxn(tmpChunk.ground) do
    if ( x % world.width == 0) then
      y = y + 1
      x = 0
    end
    x=x+1
    --random noise for ground tiles.
    n = love.math.noise(love.math.random()+x+id*tmpChunk.x,love.math.random()+y+id*tmpChunk.y)

    if n < 0.5 then
      tmpChunk.ground[i] = 0

    end
  end


  for smoothingPass = 1, 3 do
    print("Smoothning water. Pass: ".. smoothingPass)
    y = 0
    for ii = 1, table.maxn(tmpChunk.ground) do
      if ( x % world.width == 0) then
        y = y + 1
        x = 0
      end
      x=x+1
      wc = 0
      aroundTiles = getTilesAroundTile(tmpChunk.ground,ii)
      for iii  = 1, table.maxn(aroundTiles) do
        if aroundTiles[iii] == 0 then
          wc = wc + 1
        end
      end
      if wc <= 3 then
        tmpChunk.ground[ii] = 1
      end
      if wc > 4 then
        tmpChunk.ground[ii] = 0
      end
    end
  end

  print("genning Entitys")
  for i = 1, table.maxn(tmpChunk.entitys) do
    if ( x % world.width == 0) then
      y = y + 1
      x = 0
    end
    x=x+1
    --random noise for ground tiles.
    n = love.math.noise(love.math.random()+x+id*tmpChunk.x,love.math.random()+y+id*tmpChunk.y)

    if tmpChunk.ground[i] ~= 0 then
      if n > 0.8990 then
        tmpChunk.entitys[i] = deepcopy(entityProtos.peasant)

        table.insert(tmpChunk.entitys[i].wants,{itemName = getItemByName("axe").name, amount = 1})
        table.insert(tmpChunk.entitys[i].wants,{itemName = getItemByName("tree").name, amount = 1})
        table.insert(tmpChunk.entitys[i].wants,{itemName = getItemByName("rock").name, amount = 1})

      end
      if n > 0.8995 then
        tmpChunk.entitys[i] = deepcopy(entityProtos.goblin)
          table.insert(tmpChunk.entitys[i].wants,{itemName = getItemByName("pickaxe").name, amount = 1})

      end
      if  n > 0.90 then
        tmpChunk.entitys[i] = deepcopy(entityProtos.tree)
      end
      if  n > 0.95 then
        tmpChunk.entitys[i] = deepcopy(entityProtos.rock)
      end

    end

  end


  return tmpChunk
end

function getTilesAroundTile(tiles, tileID)

  aroundTiles = {}

  UL = tileID - world.width - 1
  U  = tileID - world.width
  UR = tileID - world.width + 1
  L  = tileID - 1
  R  = tileID + 1
  DL = tileID + world.width  - 1
  D  = tileID + world.height
  DR = tileID + world.height + 1

  table.insert(aroundTiles,  tiles[UL])
  table.insert(aroundTiles, tiles[U])
  table.insert(aroundTiles, tiles[UR])
  table.insert(aroundTiles, tiles[L])
  table.insert(aroundTiles, tiles[R])
  table.insert(aroundTiles, tiles[DL])
  table.insert(aroundTiles, tiles[D])
  table.insert(aroundTiles, tiles[DR])
  return aroundTiles
end
